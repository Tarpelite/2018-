# 计算机网络Notes  

## 网络层-路由算法  

### 路由的基本概念  

路由器主要完成两个功能：一个是路由选择（确定哪一条路径），另一个是分组转发（当一个分组到达时所采取的动作）。前者是根据特定的路由选择协议构造出路由表，同时经常或定期地和相邻路由器交换路由信息而不断地更新和维护路由表。后者处理通过路由器的数据流，关键操作是转发表查询、转发以及相关的队列管理和任务调度等。  

### RIP算法 

路由信息协议（Routing Information Protocol, RIP)是内部网关IGP中最先得到广泛应用的协议。RIP协议是一种分布式的基于距离向量的路由选择协议，其最大优点是简单。  

1. 网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录（因此，这是一组距离，称“距离向量”）  
2. 距离也称为跳数（Hop count），规定从一路由器到直接连接的网络距离（跳数）为1。而每经过一个路由器，则距离（跳数）加1。  
3. RIP认为好的路由就是它通过的路由器数目少，即优先选择跳数少的路径。  
4. RIP允许一条路径最多只能包含15个路由器（即最多允许15跳）。因此距离等于16时，它表示网络不可到达。可见RIP只适用于小型互联网，距离向量路由可能会出现环路的情况，规定路径上的最高跳数的目的是为了防止数据报不断循环在环路上，减少网络拥塞的可能性。  
5. RIP默认在任意两个适用RIP协议的路由器之间每30秒广播一次RIP路由更新信息。以便自动建立并维护路由表（动态维护）。  
6. 在RIP中不支持子网掩码的RIP广播，所以RIP中每个网络的子网掩码必须相同。但在新的RIP2中，支持变长子网掩码和CIDR。  

#### RIP协议的特点（注意与OSPF协议的特点比较）  

1. 仅和相邻路由器交换信息。  
2. 路由器交换的信息是当前路由器所知道的全部信息，即自己的路由表，
3. 按固定的时间间隔交换路由信息，如每隔30秒。  

#### 具体算法：  

每一个路由表项目都有三个关键数据：<目的网路N，距离d，下一跳路由器X>。对于每一个相邻路由器发送过来的RIP报文，进行以下步骤：  

1. 对地址为X的相邻路由器发来的RIP报文，先修改此报文中的所有项目：把“下一跳”字段中的地址都改为X，并把所有的“距离”字段的值加1。  
2. 对修改后的RIP报文中的每一个项目，进行一下步骤：  
    + 当原来的路由表中没有目的网络N时，则把该项目添加到路由表中。  
    + 当原来的路由表中有目的网络N，且下一跳路由器地址是X时，则用收到的项目替换原路由表中的项目。  
    + 当原来的路由表中有目的网络N，且下一跳路由器地址不是X时，如果收到的项目中的距离d小于路由表中的距离，就用收到的项目替换原路由表中的项目；否则什么也不做。  
3. 如果180秒还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达的路由器，即把距离置为16（距离为16表示不可达）。  
4. 返回。  

### OSPF路由协议  

1. OSPF协议的基本特点  

开放最短路径优先（OSPF）协议是使用分布式链路状态路由算法的典型代表，它也是内部网关协议IGP的一种。OSPF与RIP协议相比有以下4点主要区别： 

1. OSP向本自治系统中所有路由器发送信息，这里的方法是洪泛法。而RIP协议是仅仅向自己相邻的几个路由器发送信息。  
2. 发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。“链路状态”就是说明本路由器和哪些路由器相邻，以及该链路的“度量”（或代价）。而在RIP协议中，发送的信息是本路由器所知道的全部信息，即整个路由表。  
3. 只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息，并且更新过程收敛得快，不会出现RIP协议“坏消息传得慢”的问题。而在RIP协议中，不管网络拓扑是否发生变化，路由器之间都会定期交换路由表的信息。  
4. OSPF是网络层协议，它不使用UDP或TCP而是直接IP数据报传送。而RIP是应用层协议，它在传输层使用UDP协议。  

除了以上区别外，OSPF还有以下的特点：

1. OSPF对不同的链路可根据IP分组的不同服务类型（TOS）而设置成不同的代价，因此，OSPF对于不同类型的业务可计算出不同的路由，因此十分灵活。  
2. 如果到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径，这叫做多路径间的**负载平衡**。  
3. 所有在OSPF路由器之间交换的分组都具有鉴别的功能。因而保证了仅在可信赖的路由器之间交换链路状态信息。  
4. 支持可变长度的子网划分和无分类编址CIDR。  
5. 每一个链路状态都带上一个32位的序号，序号越大状态就越新。  

#### OSPF的基本工作原理  

由于各路由器之间频繁地交换链路撞他信息，因此所有的路由器最终都建立一个链路数据库。这个数据库实际上就是全网的拓扑结构图，它在全网范围内是一致的（这称为链路数据库的同步）。然后，每个路由器就更具这个全网拓扑结构图，使用dijkstra最短路径算法计算出从自己到各自的网路最优路径，以此构造自己的路由表。在此之后，当链路状态发生变化时，各个路由器重新计算岛各自的网络的最优路径，构造新的路由表。  
为了使OSPF能够用于规模很大的网络，OSPF将一个自治系统再划分为若干个更小的范围，叫做区域。划分区域的好处就是将利用洪泛法交换链路状态信息的范围局限于每一个取悦而不是整网络拓扑，而不知道其他区域的网络拓扑的情况。这些区域也有层次之分。处在上层的域叫主干区域，负责连通其他下层的区域，并且还连接其他自治域。  

#### OSPF五种分组类型  

1. 问候分组：用来发现和维持邻站的可达性。  
2. 数据库描述分组： 向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。  
3. 链路状态请求分组： 向对方请求发送某些链路状态项目的详细信息。  
4. 链路状态更新分组：用洪泛法对全网更新链路状态。  
5. 链路状态确认分组: 对链路更新分组的确认。  

每隔10秒，每两个相邻路由器要交换一次问候分组，以便知道哪些站可达。在路由器刚开始工作时，OSPF让每一个路由器使用数据库描述分组和相邻路由器交换本数据库中已有的链路状态摘要信息。然后，路由器就使用链路状态请求分组，向对方请求发送自己所缺少的某些链路状态项目的详细信息。  
在网络运行的过程中，只要一个路由器的链路状态发生变化，该路由器就要使用链路状态更新分组，用洪泛法向全网更新链路状态。其他路由器在更新后，发送链路状态确认分组对更新分组进行确认。  
为了确保链路状态数据库与全网的状态保持一致，OSPF还规定每隔一段时间，如30分钟，要刷新一次数据库中的链路状态，由于一个路由器的链路状态只设计与相邻路由器的连通状态，因而与整个互联网的规模并无直接关系.