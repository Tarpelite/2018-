# 第十一章 代码优化  

## 概述 

### 代码优化  

#### 目的：

提高目标代码运行效率：  

+ 时间效率（减少运行时间） 
+ 空间效率（减少内存容量）

#### 原则：

进行优化必须严格遵循“不能改变原有程序语义”原则。  

#### 优化的分类  

从优化的层次，与机器是否有关，分为：

+ 独立于机器的优化
+ 与机器有关的优化  

从优化涉及的范围，又分为：  

+ 局部优化：在基本块内进行的优化  
+ 循环优化： 对循环语句所生成的中间代码序列上锁进行的优化。  
+ 全局优化： 顾名思义，跨越多个基本块的全局范围内的优化。  

##### 基本块的定义：

+ 只有一个入口和一个出口，且语句为顺序执行的程序段。  
+ 它使得所有转向该基本块的入口都是该基本块的第一条语句。  
+ 如果块中任一语句被执行，则该块内的所有语句也将被执行（无分支），且执行次数一样（无循环）。  

### 优化的基本方法和例子  

+ 利用代数性质（代数变换）：
    常数计算、数组下标计算，运算轻度削弱（将乘法转换成加法） 
+ 复写传播：
    删除多余的赋值语句。  
+ 删除公共子表达式  
+ 删除冗余代码：
    不会执行的if分支（死代码）  
+ 循环优化：
    1. 删去循环体内的死代码  
    2. 外提不变表达式  
    3. 循环展开（以空间换时间）  
        **判断准则**：
        + 主机资源丰富，处理机时间昂贵  
        + 循环体语句越少越好  
        + 循环展开有利（大型机）  
        **实现步骤**：
        1. 识别循环结构，确定循环的初值、终值和步长。  
        2. 判断。  
        3. 展开。  
+ 归纳变量的优化和条件判断的替换  
+ 把多重嵌套的循环变成单层循环  
+ 把n个相同形式的循环合成一个循环等  
+ in_line展开